@model ApartmentController.Index_VM
@{
    var cities = ViewBag.cities as List<City>;

}
<div id="modalPlaceHolder" aria-hidden="true"></div>
<div class="card mb-4 border-0">
    <div class="card-header">
        <i class="fas fa-table mr-1"></i>
        @Model.PageTitle
    </div>

    @*@using (Html.BeginForm("Index", "Apartment", FormMethod.Get))
    {*@
        <form asp-action="Index" asp-controller="Apartment" method="get" id="myForm" >
        <div class="row ml-2">

            <div class="col-md-3 mt-2">

                <label>Şehir Seç </label>

                @if (cities != null)
                {
                    <select name="cityId" class="form-control" asp-for="CityId">
                        <option value="">Tüm Şehirler</option>
                        @foreach (var city in cities)
                        {
                            <option value="@city.CityId">@city.CityName</option>
                        }
                    </select>
                }
            </div>
        </div>
        <div class="row ml-2 col-md-3">

            <button type="submit" class="btn btn-primary mt-2 mr-1">Listele</button>
            <input type="button" class="btn btn-primary mt-2 mr-1" value="Sıfırla" onclick="location.href='@Url.Action("Index")'" />
           
        </div>
       

    @*}*@

    <div class="card-body">
        <div class="row ml-1 mb-auto">
            <div class=" mt-2">
                <a asp-controller="Apartment" asp-action="Add" class="btn btn-success">
                    <i class="material-icons">&#xE147;</i>
                    <span>Apartman Ekle</span>
                </a>

            </div>
            <div class="col-md-2 ml-auto">
                <select id="orderList" class="form-control" name="OrderBy" asp-for="OrderBy" asp-items="@Model.SortOptions"></select>
            </div>
        </div>
    </form>
        <div class="col-sm-12 text-right">
            <div class="dataTables_info F11" id="bootstrap-data-table-export_info" role="status" aria-live="polite">
                <b>@Model.MyPagination.TotalRecords</b> kayit bulunmaktadir.
            </div>

            <input type="hidden" name="pageIndex" id="pageIndex" value="1" />
        </div>
        <div class="table-responsive">
            <table class="table  table-striped table-hover text-center" id="apartmentTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Apartman Adı</th>
                        <th>Adres</th>
                        <th>Yönetici Bilgisi</th>
                        <th>Daire Sayısı</th>
                        <th>Güncelleyen</th>
                        <th>Güncelleme Tarihi</th>
                        <th>Aktiflik Durumu</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>

                <tbody>

                    @foreach (var item in Model.PagedList)
                    {
                        <tr>
                            <td>@item.ApartmentName</td>
                            <td>@item.OpenAdress, Kapı No:@item.DoorNumber, @item.CityName, @item.CountyName</td>
                            <td>@item.NameSurname,@item.PhoneNumber</td>
                            <td>@item.NumberOfFlats</td>
                            <td>@item.UpdatedBy</td>
                            <td>@item.UpdatedDate</td>
                            <td>
                                @if (item.IsActive == 1)
                                {
                                    <i class="fas fa-check-circle fa-lg text-success"></i>
                                }
                                else
                                {
                                    <i class="fas fa-times-circle fa-lg text-danger"></i>
                                }
                            </td>
                            <td>
                                <a class="btn btn-primary btn-sm btn-update" asp-controller="Apartment" asp-action="Update" asp-route-guid="@item.Guid"><span class="fas fa-edit"></span></a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="pagination-container">
            @await Html.PartialAsync("Pagination", @Model.MyPagination)

        </div>

    </div>

    <script>
         document.addEventListener("DOMContentLoaded", function() {
            const orderList = document.querySelector('#orderList');
            const myForm = document.querySelector('#myForm');

            orderList.addEventListener('change', () => {
                myForm.submit();
            });
        });

    </script>
